<Window x:Class="GymManagementSystem.Views.Dialogs.MemberHistoryDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Member History" 
        Height="700" 
        Width="900"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Member Info Header -->
        <materialDesign:Card Grid.Row="0" Margin="0,0,0,15" Padding="20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Member Photo -->
                <Border Grid.Column="0" 
                        Width="100" 
                        Height="100" 
                        CornerRadius="50" 
                        Margin="0,0,20,0" 
                        BorderBrush="#00BFA5" 
                        BorderThickness="2">
                    <Border.Background>
                        <ImageBrush x:Name="imgMemberPhoto" Stretch="UniformToFill"/>
                    </Border.Background>
                </Border>
                
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock x:Name="txtMemberName" 
                               Text="Member Name" 
                               FontSize="24" 
                               FontWeight="Bold" 
                               Foreground="#00BFA5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                        <TextBlock Text="ID: " FontWeight="SemiBold"/>
                        <TextBlock x:Name="txtMemberId" Text=""/>
                        <TextBlock Text="  |  Phone: " FontWeight="SemiBold" Margin="15,0,0,0"/>
                        <TextBlock x:Name="txtPhone" Text=""/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                        <TextBlock Text="Registration: " FontWeight="SemiBold"/>
                        <TextBlock x:Name="txtRegistrationDate" Text=""/>
                    </StackPanel>
                </StackPanel>
                
                <StackPanel Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Top">
                    <TextBlock x:Name="txtPaymentStatus" 
                               Text="Status" 
                               FontSize="16" 
                               FontWeight="Bold" 
                               HorizontalAlignment="Right"/>
                </StackPanel>
            </Grid>
        </materialDesign:Card>

        <!-- Package & Payment Info -->
        <materialDesign:Card Grid.Row="1" Margin="0,0,0,15" Padding="20" Background="#F5F5F5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0">
                    <TextBlock Text="Current Package" 
                               FontSize="12" 
                               FontWeight="SemiBold" 
                               Foreground="Gray"/>
                    <TextBlock x:Name="txtCurrentPackage" 
                               Text="No Package" 
                               FontSize="18" 
                               FontWeight="Bold" 
                               Foreground="#9C27B0"
                               Margin="0,5,0,0"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1">
                    <TextBlock Text="Next Payment Due" 
                               FontSize="12" 
                               FontWeight="SemiBold" 
                               Foreground="Gray"/>
                    <TextBlock x:Name="txtNextDueDate" 
                               Text="N/A" 
                               FontSize="18" 
                               FontWeight="Bold" 
                               Foreground="#FF6F00"
                               Margin="0,5,0,0"/>
                </StackPanel>
                
                <StackPanel Grid.Column="2">
                    <TextBlock Text="Package End Date" 
                               FontSize="12" 
                               FontWeight="SemiBold" 
                               Foreground="Gray"/>
                    <TextBlock x:Name="txtPackageEndDate" 
                               Text="N/A" 
                               FontSize="18" 
                               FontWeight="Bold" 
                               Foreground="#D32F2F"
                               Margin="0,5,0,0"/>
                </StackPanel>
            </Grid>
        </materialDesign:Card>

        <!-- Payment / Attendance / Fingerprint History -->
        <materialDesign:Card Grid.Row="2">
            <TabControl>
                <TabItem Header="Payments">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" 
                                Background="#00BFA5" 
                                Padding="15">
                            <TextBlock Text="Payment History" 
                                       FontSize="16" 
                                       FontWeight="Bold" 
                                       Foreground="White"/>
                        </Border>

                        <DataGrid x:Name="dgPaymentHistory" 
                                  Grid.Row="1"
                                  AutoGenerateColumns="False" 
                                  IsReadOnly="True"
                                  CanUserAddRows="False"
                                  Margin="10">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Payment ID" Binding="{Binding PaymentId}" Width="80"/>
                                <DataGridTextColumn Header="Package" Binding="{Binding MembershipPackage.PackageName}" Width="150"/>
                                <DataGridTextColumn Header="Amount" Binding="{Binding Amount, StringFormat=Rs. {0:N2}}" Width="120">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                            <Setter Property="Foreground" Value="Green"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Payment Date" Binding="{Binding PaymentDate, StringFormat=dd/MM/yyyy}" Width="120"/>
                                <DataGridTextColumn Header="Start Date" Binding="{Binding StartDate, StringFormat=dd/MM/yyyy}" Width="110"/>
                                <DataGridTextColumn Header="End Date" Binding="{Binding EndDate, StringFormat=dd/MM/yyyy}" Width="110"/>
                                <DataGridTextColumn Header="Method" Binding="{Binding PaymentMethod}" Width="80"/>
                                <DataGridTextColumn Header="Remarks" Binding="{Binding Remarks}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <Border Grid.Row="2" 
                                Background="#E3F2FD" 
                                Padding="15" 
                                BorderBrush="#2196F3" 
                                BorderThickness="0,1,0,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Orientation="Horizontal">
                                    <TextBlock Text="Total Payments: " FontWeight="SemiBold" FontSize="14"/>
                                    <TextBlock x:Name="txtTotalPayments" Text="0" FontSize="14" Margin="5,0,0,0"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="20,0,0,0">
                                    <TextBlock Text="Last Payment: " FontWeight="SemiBold" FontSize="14"/>
                                    <TextBlock x:Name="txtLastPaymentDate" Text="N/A" FontSize="14" Margin="5,0,0,0"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="20,0,0,0">
                                    <TextBlock Text="Total Amount: " FontWeight="SemiBold" FontSize="14"/>
                                    <TextBlock x:Name="txtTotalAmount" 
                                               Text="Rs. 0.00" 
                                               FontSize="14" 
                                               FontWeight="Bold" 
                                               Foreground="Green" 
                                               Margin="5,0,0,0"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </TabItem>
                <TabItem Header="Attendance">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" 
                                Background="#2196F3" 
                                Padding="15">
                            <TextBlock Text="Attendance History" 
                                       FontSize="16" 
                                       FontWeight="Bold" 
                                       Foreground="White"/>
                        </Border>

                        <DataGrid x:Name="dgAttendanceHistory" 
                                  Grid.Row="1"
                                  AutoGenerateColumns="False" 
                                  IsReadOnly="True"
                                  CanUserAddRows="False"
                                  Margin="10">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Date" Binding="{Binding DateDisplay}" Width="120"/>
                                <DataGridTextColumn Header="Check-In" Binding="{Binding CheckInDisplay}" Width="110"/>
                                <DataGridTextColumn Header="Check-Out" Binding="{Binding CheckOutDisplay}" Width="110"/>
                                <DataGridTextColumn Header="Duration" Binding="{Binding DurationDisplay}" Width="110"/>
                                <DataGridTextColumn Header="Type" Binding="{Binding AttendanceType}" Width="120"/>
                                <DataGridTextColumn Header="Remarks" Binding="{Binding Remarks}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <Border Grid.Row="2" 
                                Background="#E3F2FD" 
                                Padding="15" 
                                BorderBrush="#2196F3" 
                                BorderThickness="0,1,0,0">
                            <Grid>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock x:Name="txtTotalAttendance" Text="Total Attendance: 0 days" FontWeight="SemiBold" FontSize="14"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </TabItem>
                <TabItem Header="Fingerprint">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0"
                                Background="#E91E63"
                                Padding="15">
                            <TextBlock Text="Fingerprint Enrollment History"
                                       FontSize="16"
                                       FontWeight="Bold"
                                       Foreground="White"/>
                        </Border>

                        <DataGrid x:Name="dgFingerprintHistory"
                                  Grid.Row="1"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  CanUserAddRows="False"
                                  Margin="10">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Date / Time"
                                                    Binding="{Binding EnrollmentLocal}"
                                                    Width="160"/>
                                <DataGridTextColumn Header="Device ID"
                                                    Binding="{Binding DeviceId}"
                                                    Width="80"/>
                                <DataGridTextColumn Header="Result"
                                                    Binding="{Binding Status}"
                                                    Width="120"/>
                                <DataGridTextColumn Header="Details"
                                                    Binding="{Binding Message}"
                                                    Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>
            </TabControl>
        </materialDesign:Card>

        <!-- Close Button -->
        <Button Grid.Row="3" 
                Content="CLOSE" 
                Style="{StaticResource MaterialDesignFlatButton}"
                HorizontalAlignment="Right"
                Margin="0,15,0,0"
                MinWidth="100"
                Height="40"
                Click="btnClose_Click"/>
    </Grid>
</Window>
