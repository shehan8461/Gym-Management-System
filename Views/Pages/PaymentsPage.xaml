<Page x:Class="GymManagementSystem.Views.Pages.PaymentsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      Title="Payments"
      Background="#f0f2f5">
    
    <Grid Margin="32,24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <StackPanel>
                <TextBlock Text="Payment Management" FontSize="32" FontWeight="Bold" Foreground="#202124"/>
                <TextBlock Text="Track and manage member payments and subscriptions" 
                           FontSize="15" Foreground="#5f6368" Margin="0,4,0,0"/>
            </StackPanel>
        </Grid>

        <!-- Filter Options -->
        <materialDesign:Card Grid.Row="1" Margin="0,0,0,20" Padding="20" UniformCornerRadius="12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Background="#f5f5f5" CornerRadius="10" Padding="4">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <materialDesign:PackIcon Grid.Column="0" Kind="Magnify" 
                                                 Width="24" Height="24" 
                                                 Foreground="#5f6368" 
                                                 VerticalAlignment="Center" 
                                                 Margin="12,0,8,0"/>
                        
                        <TextBox x:Name="txtSearch" 
                                 Grid.Column="1"
                                 materialDesign:HintAssist.Hint="Search by member name..."
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 FontSize="15"
                                 VerticalAlignment="Center"
                                 TextChanged="txtSearch_TextChanged"/>
                    </Grid>
                </Border>

                <ComboBox x:Name="cmbStatusFilter" 
                          Grid.Column="1"
                          materialDesign:HintAssist.Hint="Filter by Status"
                          Style="{StaticResource MaterialDesignOutlinedComboBox}"
                          Margin="16,0,0,0"
                          Height="48"
                          FontSize="14"
                          SelectionChanged="cmbStatusFilter_SelectionChanged">
                    <ComboBoxItem Content="All Status" IsSelected="True"/>
                    <ComboBoxItem Content="Paid"/>
                    <ComboBoxItem Content="Due Soon"/>
                    <ComboBoxItem Content="Overdue"/>
                </ComboBox>

                <Button x:Name="btnRefresh" 
                        Grid.Column="2"
                        Width="48"
                        Height="48"
                        Margin="12,0,0,0"
                        Style="{StaticResource MaterialDesignIconButton}"
                        ToolTip="Refresh"
                        Click="btnRefresh_Click">
                    <materialDesign:PackIcon Kind="Refresh" Width="24" Height="24"/>
                </Button>
            </Grid>
        </materialDesign:Card>

        <!-- Payments DataGrid -->
        <materialDesign:Card Grid.Row="2" Padding="0" UniformCornerRadius="12">
            <DataGrid x:Name="dgPayments" 
                      AutoGenerateColumns="False" 
                      IsReadOnly="True"
                      CanUserAddRows="False"
                      HeadersVisibility="Column"
                      GridLinesVisibility="None"
                      Background="White"
                      RowBackground="White"
                      AlternatingRowBackground="#fafafa"
                      BorderThickness="0">
                <DataGrid.Resources>
                    <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}">
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="Foreground" Value="#202124"/>
                        <Setter Property="Background" Value="#f5f5f5"/>
                        <Setter Property="Padding" Value="16,14"/>
                        <Setter Property="Height" Value="56"/>
                    </Style>
                    <Style TargetType="DataGridCell" BasedOn="{StaticResource MaterialDesignDataGridCell}">
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="16,12"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="Foreground" Value="#202124"/>
                    </Style>
                    <Style TargetType="DataGridRow" BasedOn="{StaticResource MaterialDesignDataGridRow}">
                        <Setter Property="Height" Value="64"/>
                    </Style>
                </DataGrid.Resources>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" Binding="{Binding PaymentId}" Width="70"/>
                    <DataGridTextColumn Header="Member ID" Binding="{Binding MemberId, StringFormat=MEM-{0:0000}}" Width="140" MinWidth="140"/>
                    <DataGridTextColumn Header="Member Name" Binding="{Binding MemberName}" Width="*" MinWidth="160"/>
                    <DataGridTextColumn Header="Package" Binding="{Binding PackageName}" Width="150"/>
                    <DataGridTextColumn Header="Amount" Binding="{Binding Amount, StringFormat='LKR {0:N2}'}" Width="120"/>
                    <DataGridTextColumn Header="Payment Date" Binding="{Binding PaymentDate, StringFormat=dd/MM/yyyy}" Width="120"/>
                    <DataGridTextColumn Header="End Date" Binding="{Binding EndDate, StringFormat=dd/MM/yyyy}" Width="110"/>
                    <DataGridTextColumn Header="Next Due" Binding="{Binding NextDueDate, StringFormat=dd/MM/yyyy}" Width="110"/>
                    <DataGridTemplateColumn Header="Status" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="12" Padding="12,6" HorizontalAlignment="Center">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding StatusDisplay}" Value="Paid">
                                                    <Setter Property="Background" Value="#e8f5e9"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding StatusDisplay}" Value="Due Soon">
                                                    <Setter Property="Background" Value="#fff3e0"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding StatusDisplay}" Value="Overdue">
                                                    <Setter Property="Background" Value="#ffebee"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Text="{Binding StatusDisplay}" FontSize="12" FontWeight="SemiBold">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding StatusDisplay}" Value="Paid">
                                                        <Setter Property="Foreground" Value="#2e7d32"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding StatusDisplay}" Value="Due Soon">
                                                        <Setter Property="Foreground" Value="#f57c00"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding StatusDisplay}" Value="Overdue">
                                                        <Setter Property="Foreground" Value="#c62828"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Method" Binding="{Binding PaymentMethod}" Width="100"/>
                </DataGrid.Columns>
            </DataGrid>
        </materialDesign:Card>
    </Grid>
</Page>
